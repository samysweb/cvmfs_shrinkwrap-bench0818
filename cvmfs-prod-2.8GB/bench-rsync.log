Benchmark Script: 
#! /bin/bash
echo "Benchmark Script: "
cat run.sh
echo ""
echo "Spec File contents:"
cat cvmfs-spec/cernvm-prod.cern.ch.spec.txt
echo ""
echo "Config file contents:"
cat cvmfs-config.config
echo ""

CVMFS_BASE=`pwd`"/../cvmfs"
TMP_BASE="/home/samuel/benchmark/tmp"

# Make shrinkwrap accessible
source env.sh
echo $PATH

run_shrinkwrap() {
  # run_shrinkwrap [num_threads] [run_log]
  $(echo "$CVMFS_BASE")/cvmfs/shrinkwrap/scripts/build.sh --spec_dir=cvmfs-spec --cvmfs_config=cvmfs-config.config --dest_base=$TMP_BASE/cvmfs/cvmfs --dest_data=$TMP_BASE/cvmfs/cvmfs/.data --threads=$1 >> $2
}

run_rsync() {
  ls /cvmfs/cernvm-prod.cern.ch > /dev/null
  rsync -a \
    --relative --prune-empty-dirs \
    --include='/' \
    --include='/cvmfs/' \
    --include='/cvmfs/cernvm-prod.cern.ch/'\
    --include='/cvmfs/cernvm-prod.cern.ch/cvm4/'\
    --include='/cvmfs/cernvm-prod.cern.ch/cvm4/usr'\
    --include='/cvmfs/cernvm-prod.cern.ch/cvm4/usr/lib64'\
    --include='/cvmfs/cernvm-prod.cern.ch/cvm4/usr/lib64/***' \
    --exclude '*' \
    /cvmfs $TMP_BASE/cvmfs >> $1
}

run_test() {
  # run_test [num of runs] [num of threads] [run log]
  echo "*** Testing command '$2' with $1 runs..." >> $3
  echo "*** Testing command '$2' with $1 runs..."
  SIZES=()
  TIMES=()
  SUM=0
  for i in $(eval echo {1..$1});
  do
    echo "*** Starting run $i" >> $3
    sync
    echo 3 > /proc/sys/vm/drop_caches
    rm -rf $TMP_BASE/cvmfs
    START=$(date +%s.%N)
    eval $2
    sync
    END=$(date +%s.%N)
    DIFF=$(echo "$END - $START" | bc)
    SIZES[$i]=$(du -sh $TMP_BASE/cvmfs/cvmfs)
    TIMES[$i]=$DIFF
    SUM=$(echo "$SUM + $DIFF" | bc)
    echo "*** Cleaning up run $i" >> $3
    rm -rf $TMP_BASE/cvmfs
  done
  echo "Sizes: ${SIZES[@]}"
  echo "Times: ${TIMES[@]}"
  echo "Average: $(echo "$SUM / $1" | bc -l)"
}

main() {
  # main [run log] > bench log
  echo "****** Starting Benchmark ******"
  echo "*** Cleaning up if necessary..." > $1
  rm -rf $TMP_BASE/cvmfs
  echo "*** Preloading cvmfs cache (rsync)" >> $1
  service autofs restart
  run_rsync $1
  run_test 16 "run_rsync $1" $1

  echo "*** Preloading cvmfs shrinkwrap cache" >> $1
  run_shrinkwrap 32 $1
  rm -rf $TMP_BASE/cvmfs

  run_test 16 "run_shrinkwrap 1 $1" $1
  run_test 16 "run_shrinkwrap 4 $1" $1
  run_test 16 "run_shrinkwrap 8 $1" $1
  run_test 16 "run_shrinkwrap 16 $1" $1
  run_test 16 "run_shrinkwrap 32 $1" $1
  run_test 16 "run_shrinkwrap 64 $1" $1
  echo "****** Benchmark ended successfully ******"
}

main $@

Spec File contents:
^/*
^/cvm4/*'
/cvm4/usr/*

Config file contents:
CVMFS_CACHE_BASE=/var/lib/cvmfs/shrinkwrap
CVMFS_CLAIM_OWNERSHIP=yes
CVMFS_CONFIG_REPOSITORY=cvmfs-config.cern.ch
CVMFS_SERVER_URL="http://cvmfs-stratum-zero-hpc.cern.ch/cvmfs/@fqrn@;http://cvmfs-stratum-one.cern.ch/cvmfs/@fqrn@;http://cvmfs-s1bnl.opensciencegrid.org:8000/cvmfs/@fqrn@"
CVMFS_KEYS_DIR=/etc/cvmfs/keys/cern.ch
CVMFS_HTTP_PROXY=DIRECT
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/home/samuel/benchmark/../cvmfs/build/cvmfs/
****** Starting Benchmark ******
*** Testing command 'run_rsync run.log' with 16 runs...
Sizes: 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs 2.9G	/home/samuel/benchmark/tmp/cvmfs/cvmfs
Times: 199.823512442 42.917655595 42.154552945 41.937312422 42.269078481 42.087049814 53.408366211 60.318001616 57.885547934 59.777547721 57.292708700 59.102609485 59.166205686 58.888463271 58.090495447 60.568516147
Average: 62.23047649481250000000
